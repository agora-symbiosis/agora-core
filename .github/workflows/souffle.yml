name: ðŸŒ¬ï¸ Souffle â€” Validation des fragments

on:
  push:
    branches: [ main ]
    paths:
      - 'policies/**'
      - 'examples/**'
      - 'tools/**'
  pull_request:
    branches: [ main ]
    paths:
      - 'policies/**'
      - 'examples/**'
      - 'tools/**'

jobs:
  validate:
    name: VÃ©rification du Souffle
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ§­ Cloner le dÃ©pÃ´t
        uses: actions/checkout@v4

      - name: ðŸ Installer Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: ðŸŒ¬ï¸ ExÃ©cuter le moteur du Souffle
        run: |
          echo "::group::RÃ©sultats"
          for file in examples/*.json; do
            echo "Analyse du fragment: $file"
            python3 tools/souffle_policy_engine.py policies/souffle.config.json "$file" > output.json
            cat output.json
            echo "---"
          done
          echo "::endgroup::"

      - name: ðŸ§¾ Publier le rapport
        uses: actions/upload-artifact@v4
        with:
          name: souffle-reports
          path: output.json
